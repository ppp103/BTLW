@{
	ViewData["Title"] = "HienThiSanPham";
	Layout = "~/Views/Shared/_UserLayout.cshtml";
}
@using X.PagedList.Mvc.Core
@model X.PagedList.IPagedList<Sach>
<div class="tg-innerbanner tg-haslayout tg-parallax tg-bginnerbanner" data-z-index="-100" data-appear-top-offset="600" data-parallax="scroll" data-image-src="../User/images/parallax/bgparallax-07.jpg">
	<div class="container">
		<div class="row">
			<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
				<div class="tg-innerbannercontent">
					<h1>Sách</h1>
					<ol class="tg-breadcrumb">
						<li><a href="javascript:void(0);">Trang chủ</a></li>
						<li class="tg-active">Sách</li>
					</ol>
				</div>
			</div>
		</div>
	</div>
</div>
<!--************************************
		Inner Banner End
*************************************-->
<!--************************************
		Main Start
*************************************-->
<main id="tg-main" class="tg-main tg-haslayout">
	<!--************************************
			News Grid Start
	*************************************-->
	<div class="tg-sectionspace tg-haslayout">
		<div class="container">
			<div class="row">
				<div id="tg-twocolumns" class="tg-twocolumns">
					<div class="col-xs-12 col-sm-8 col-md-8 col-lg-9 pull-right">
						<div id="tg-content" class="tg-content">
							<div class="tg-products">
								<div class="tg-sectionhead">
									<h2>Danh sách sản phẩm</h2>
								</div>
								@Html.PagedListPager(Model,page => Url.Action("HienThiSanPham", new {page=page}),new X.PagedList.Web.Common.PagedListRenderOptions(){
								LiElementClasses = new List<String> {"page-item"},
								PageClasses = new List<String> {"page-link"}
								})
								<div class="tg-productgrid">
									<div id="displayBooks">
										@foreach (var sp in Model)
										{
											@*<input id="MaSach" asp-for="@sp.MaSach" type="hidden" />
*@
											<div class="col-xs-6 col-sm-6 col-md-4 col-lg-3">
												<div class="tg-postbook">
													<figure class="tg-featureimg">
														<div class="tg-bookimg">
															<div class="tg-frontcover"><img src="@Url.Content("../images/books/" + @sp.Anh)" alt="image description"></div>
															<div class="tg-backcover"><img src="@Url.Content("../images/books/" + @sp.Anh)" alt="image description"></div>
														</div>
														<a class="tg-btnaddtowishlist" href="javascript:void(0);">
															<i class="icon-heart"></i>
															<span>Yêu thích</span>
														</a>
													</figure>
													<div class="tg-postbookcontent">
														<ul class="tg-bookscategories">
															<li><a asp-controller="Home">@sp.MaDmNavigation!.TenDm</a></li>
														</ul>
														<div class="tg-themetagbox"><span class="tg-themetag">sale</span></div>
														<div class="tg-booktitle">
															<h3><a asp-controller="Home" asp-action="ChiTietSanPham" asp-route-sac="@sp.MaSach">@sp.TenSach</a></h3>
														</div>
														<span class="tg-bookwriter">Bởi: <a href="javascript:void(0);">@sp.MaTgNavigation!.TenTg</a></span>
														<span class="tg-stars"><span></span></span>
														<span class="tg-bookprice">
															<ins>@sp.GiaBan.Value.ToString("#,##0") VNĐ</ins>
														</span>
														<a class="tg-btn tg-btnstyletwo add-to-cart" data-maSach="@sp.MaSach" href="javascript:void(0);">
															<i class="fa fa-shopping-basket"></i>
															<em>Thêm vào giỏ</em>
														</a>
													</div>
												</div>
											</div>

										}
									</div>
								</div>
							</div>
						</div>
					</div>

					<div class="col-xs-12 col-sm-4 col-md-4 col-lg-3 pull-left">
						<aside id="tg-sidebar" class="tg-sidebar">
							<div class="tg-widget tg-widgetsearch">
								<form class="tg-formtheme tg-formsearch">
									<div class="form-group">
										<button type="submit"><i class="icon-magnifier"></i></button>
										<input type="search" name="search" class="form-group" placeholder="Tìm kiếm theo tên sách, ...">
									</div>
								</form>
							</div>
							<div class="tg-widget tg-catagories">
								<div class="tg-widgettitle">
									<h3>Danh mục sách</h3>
								</div>
								<div class="tg-widgetcontent">
									<ul>
										@foreach (var dm in ViewBag.madm)
										{
											var getUrl = "https://localhost:7287/api/BooksApi/" + @dm.MaDm;
											<li><a style="cursor:pointer" onclick="showBooksByCategory('@getUrl')">@dm.TenDm</a></li>
										}
									</ul>
								</div>
							</div>
							<div class="tg-widget tg-widgettrending">
								<div class="tg-widgettitle">
									<h3>Sách thịnh hành</h3>
								</div>
								<div class="tg-widgetcontent">
									<ul>
										<li>
											<article class="tg-post">
												<figure><a href="javascript:void(0);"><img src="../User/images/products/img-04.jpg" alt="image description"></a></figure>
												<div class="tg-postcontent">
													<div class="tg-posttitle">
														<h3><a href="javascript:void(0);">Where The Wild Things Are</a></h3>
													</div>
													<span class="tg-bookwriter">Bởi: <a href="javascript:void(0);">Kathrine Culbertson</a></span>
												</div>
											</article>
										</li>
										<li>
											<article class="tg-post">
												<figure><a href="javascript:void(0);"><img src="../User/images/products/img-05.jpg" alt="image description"></a></figure>
												<div class="tg-postcontent">
													<div class="tg-posttitle">
														<h3><a href="javascript:void(0);">Where The Wild Things Are</a></h3>
													</div>
													<span class="tg-bookwriter">Bởi: <a href="javascript:void(0);">Kathrine Culbertson</a></span>
												</div>
											</article>
										</li>
										<li>
											<article class="tg-post">
												<figure><a href="javascript:void(0);"><img src="../User/images/products/img-06.jpg" alt="image description"></a></figure>
												<div class="tg-postcontent">
													<div class="tg-posttitle">
														<h3><a href="javascript:void(0);">Where The Wild Things Are</a></h3>
													</div>
													<span class="tg-bookwriter">Bởi: <a href="javascript:void(0);">Kathrine Culbertson</a></span>
												</div>
											</article>
										</li>
										<li>
											<article class="tg-post">
												<figure><a href="javascript:void(0);"><img src="../User/images/products/img-07.jpg" alt="image description"></a></figure>
												<div class="tg-postcontent">
													<div class="tg-posttitle">
														<h3><a href="javascript:void(0);">Where The Wild Things Are</a></h3>
													</div>
													<span class="tg-bookwriter">Bởi: <a href="javascript:void(0);">Kathrine Culbertson</a></span>
												</div>
											</article>
										</li>
									</ul>
								</div>
							</div>
							<div class="tg-widget tg-widgetinstagram">
								<div class="tg-widgettitle">
									<h3>Instagram</h3>
								</div>
								<div class="tg-widgetcontent">
									<ul>
										<li>
											<figure>
												<img src="../User/images/instagram/img-01.jpg" alt="image description">
												<figcaption><a href="javascript:void(0);"><i class="icon-heart"></i><em>50,134</em></a></figcaption>
											</figure>
										</li>
										<li>
											<figure>
												<img src="../User/images/instagram/img-02.jpg" alt="image description">
												<figcaption><a href="javascript:void(0);"><i class="icon-heart"></i><em>50,134</em></a></figcaption>
											</figure>
										</li>
										<li>
											<figure>
												<img src="../User/images/instagram/img-03.jpg" alt="image description">
												<figcaption><a href="javascript:void(0);"><i class="icon-heart"></i><em>50,134</em></a></figcaption>
											</figure>
										</li>
										<li>
											<figure>
												<img src="../User/images/instagram/img-04.jpg" alt="image description">
												<figcaption><a href="javascript:void(0);"><i class="icon-heart"></i><em>50,134</em></a></figcaption>
											</figure>
										</li>
										<li>
											<figure>
												<img src="../User/images/instagram/img-05.jpg" alt="image description">
												<figcaption><a href="javascript:void(0);"><i class="icon-heart"></i><em>50,134</em></a></figcaption>
											</figure>
										</li>
										<li>
											<figure>
												<img src="../User/images/instagram/img-06.jpg" alt="image description">
												<figcaption><a href="javascript:void(0);"><i class="icon-heart"></i><em>50,134</em></a></figcaption>
											</figure>
										</li>
										<li>
											<figure>
												<img src="../User/images/instagram/img-07.jpg" alt="image description">
												<figcaption><a href="javascript:void(0);"><i class="icon-heart"></i><em>50,134</em></a></figcaption>
											</figure>
										</li>
										<li>
											<figure>
												<img src="../User/images/instagram/img-08.jpg" alt="image description">
												<figcaption><a href="javascript:void(0);"><i class="icon-heart"></i><em>50,134</em></a></figcaption>
											</figure>
										</li>
										<li>
											<figure>
												<img src="../User/images/instagram/img-09.jpg" alt="image description">
												<figcaption><a href="javascript:void(0);"><i class="icon-heart"></i><em>50,134</em></a></figcaption>
											</figure>
										</li>
									</ul>
								</div>
							</div>
							<div class="tg-widget tg-widgetblogers">
								<div class="tg-widgettitle">
									<h3>Bloggers</h3>
								</div>
								<div class="tg-widgetcontent">
									<ul>
										<li>
											<div class="tg-author">
												<figure><a href="javascript:void(0);"><img src="../User/images/author/imag-03.jpg" alt="image description"></a></figure>
												<div class="tg-authorcontent">
													<h2><a href="javascript:void(0);">Jude Morphew</a></h2>
													<span>21,658 Sách xuất bản</span>
												</div>
											</div>
										</li>
										<li>
											<div class="tg-author">
												<figure><a href="javascript:void(0);"><img src="../User/images/author/imag-04.jpg" alt="image description"></a></figure>
												<div class="tg-authorcontent">
													<h2><a href="javascript:void(0);">Jude Morphew</a></h2>
													<span>21,658 Sách xuất bản</span>
												</div>
											</div>
										</li>
										<li>
											<div class="tg-author">
												<figure><a href="javascript:void(0);"><img src="../User/images/author/imag-05.jpg" alt="image description"></a></figure>
												<div class="tg-authorcontent">
													<h2><a href="javascript:void(0);">Jude Morphew</a></h2>
													<span>21,658 Sách xuất bản</span>
												</div>
											</div>
										</li>
										<li>
											<div class="tg-author">
												<figure><a href="javascript:void(0);"><img src="../User/images/author/imag-06.jpg" alt="image description"></a></figure>
												<div class="tg-authorcontent">
													<h2><a href="javascript:void(0);">Jude Morphew</a></h2>
													<span>21,658 Sách xuất bản</span>
												</div>
											</div>
										</li>
									</ul>
								</div>
							</div>
						</aside>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!--************************************
			News Grid End
	*************************************-->
</main>
<!--************************************
		Main End
*************************************-->
<!--************************************
		Main End
*************************************-->
@section Scripts{
	<script>
		function showBooksByCategory(getUrl) {
			var str = '';
			$.ajax({
				type: 'GET',
				url: getUrl,
				dataType: 'json',
				success: function (data) {
					$.each(data, function (key, a) {
						str += `							
															<div class="col-xs-6 col-sm-6 col-md-4 col-lg-3">
																<div class="tg-postbook">
																	<figure class="tg-featureimg">
																		<div class="tg-bookimg">
																				<div class="tg-frontcover"><img src="../User/images/books/${a.anh}" alt="image description"></div>
																				<div class="tg-backcover"><img src="../User/images/books/${a.anh}" alt="image description"></div>
																		</div>
																		<a class="tg-btnaddtowishlist" href="javascript:void(0);">
																			<i class="icon-heart"></i>
																			<span>Yêu thích</span>
																		</a>
																	</figure>
																	<div class="tg-postbookcontent">
																		<ul class="tg-bookscategories">
																					<li><a asp-controller="Home" asp-action="HienThiTheoDanhMuc" asp-route-madm="${a.maDm}">${a.tenDm}</a></li>
																		</ul>
																		<div class="tg-themetagbox"><span class="tg-themetag">sale</span></div>
																		<div class="tg-booktitle">
																					<h3><a asp-controller="Home" asp-action="ChiTietSanPham" asp-route-sac="${a.maSach}">${a.tenSach}</a></h3>
																		</div>
																			<span class="tg-bookwriter">By: <a href="javascript:void(0);">${a.tenTg}</a></span>
																		<span class="tg-stars"><span></span></span>
																		<span class="tg-bookprice">
																			<ins>${new Intl.NumberFormat().format(a.giaBan)} đồng</ins>
																		</span>
																		<a class="tg-btn tg-btnstyletwo add-to-cart" data-maSach="${a.maSach}" href="javascript:void(0);">
																			<i class="fa fa-shopping-basket"></i>
																			<em>Thêm vào giỏ</em>
																		</a>
																	</div>
																</div>
															</div>
						`;

					});
					$('#displayBooks').html(str);
				},
				Error: function (xhr) {
					alert(xhr.responseText)
				}
			});
		}

		$(document).ready(function () {
			$(function () {
				$(".add-to-cart").click(function () {
					var maSach = $(this).attr("data-maSach");
					var soLuong = 1;
					if (soLuong == 0) return;
					$.ajax({
						url: '/api/cart/add',
						type: "POST",
						dataType: "JSON",
						data: {
							maSach: maSach,
							soLuong: soLuong
						},
						success: function (response) {
							if (response.result == 'Redirect') {
								window.location = response.url;
							}
							else {
								alert("Thêm thành công");
								loadHeaderCart(); //Add Product success
								location.reload();
							}
						},
						error: function (error) {
							alert("There was an error posting the data to the server: " + error.responseText);
						}
					});
				});
			});
			function loadHeaderCart() {
				$('#miniCart').load("/Ajax/HeaderCart");
				$('#numberCart').load("/Ajax/NumberCart");
			}
		});
	</script>
}